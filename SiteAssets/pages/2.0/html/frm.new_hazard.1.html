<div class="tpos-info">Hazards applicable to one or many permanent works, temporary works and/or RAMS can be recorded in one go.</div>
<div class="tpos-info">Start by describing the hazard (something with the potential to cause harm). Optionally, describe the risk (what harm could come to whom/what) and your mitigation (methods of minimising the risk).</div>
<div class="tpos-info">Leave the risk and/or mitigation fields empty if you are not yet sure.</div>
<div class="input-panel" id="hazard">
    <div class="tpos-lbl">Describe the hazard</div>
    <!-- <input class="" type="text" name="input_hazard" id="input_hazard"> -->
    <textarea name="text_hazard" id="cdmHazardDescription" cols="40" rows="5"></textarea>
</div>
<div class="input-panel" id="risk">
    <div class="tpos-lbl">Describe the risk (optional)</div>
    <!-- <input class="" type="text" name="input_hazard" id="input_hazard"> -->
    <textarea name="text_risk" id="cdmRiskDescription" cols="40" rows="5"></textarea>
</div>
<div class="input-panel" id="mitigation">
    <div class="tpos-lbl">Your mitigation (optional)</div>
    <!-- <input class="" type="text" name="input_hazard" id="input_hazard"> -->
    <textarea name="text_mitigation" id="cdmMitigationDescription" cols="40" rows="5"></textarea>
</div>
<div class="risk-panel" id="inirisk">
    <div class="tpos-lbl">Initial risk score (optional)</div>
    <div id="cdmInitialRisk" style="display: none;">25-High-clr_5^5-Extreme Harm^5-Definite</div>
    <div class="riskscoring">
        <table class="risk-tbl">
            <tr>
                <td colspan="5">Severity</td>
            </tr>
            <tr>
                <td class="rs sev severity_1 clr_1" data-sev="1-Minor harm" onclick="sev(1)">
                    <div class="rss">
                        <div>1</div>
                        <div>Minor harm</div>
                    </div>
                </td>
                <td class="rs sev severity_2 clr_2" data-sev="2-Serious harm" onclick="sev(2)">
                    <div class="rss">
                        <div>2</div>
                        <div>Serious harm</div>
                    </div>
                </td>
                <td class="rs sev severity_3 clr_3" data-sev="3-Serious harm" onclick="sev(3)">
                    <div class="rss">
                        <div>3</div>
                        <div>Serious harm</div>
                    </div>
                </td>
                <td class="rs sev severity_4 clr_4" data-sev="4-Major harm" onclick="sev(4)">
                    <div class="rss">
                        <div>4</div>
                        <div>Major harm</div>
                    </div>
                </td>
                <td class="rs sev sevs severity_5 clr_5 clr_5_active" data-sev="5-Extreme harm" onclick="sev(5)">
                    <div class="rss">
                        <div>5</div>
                        <div>Extreme harm</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="5">
                    <table class="mini-risk-tbl">
                        <tr>
                            <td class="rsc rsc1 clr_1" data-rsk="1-Low-clr_1">1</td>
                            <td class="rsc rsc2 clr_1" data-rsk="2-Low-clr_1">2</td>
                            <td class="rsc rsc3 clr_1" data-rsk="3-Low-clr_1">3</td>
                            <td class="rsc rsc4 clr_1" data-rsk="4-Low-clr_1">4</td>
                            <td class="rsc rsc5 clr_4" data-rsk="5-Medium-clr_4">5</td>
                            <td class="rsc rsc6 clr_4" data-rsk="6-Medium-clr_4">6</td>
                            <td class="rsc rsc8 clr_4" data-rsk="8-Medium-clr_4">8</td>
                            <td class="rsc rsc9 clr_4" data-rsk="9-Medium-clr_4">9</td>
                            <td class="rsc rsc10 clr_5" data-rsk="10-High-clr_5">10</td>
                            <td class="rsc rsc12 clr_5" data-rsk="12-High-clr_5">12</td>
                            <td class="rsc rsc15 clr_5" data-rsk="15-High-clr_5">15</td>
                            <td class="rsc rsc16 clr_5" data-rsk="16-High-clr_5">16</td>
                            <td class="rsc rsc20 clr_5" data-rsk="20-High-clr_5">20</td>
                            <td class="rsc rsc25 clr_5 clr_5_active" data-rsk="25-High-clr_5">25</td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td class="rs lik likelihood_1 clr_1" data-lik="1-Very unlikely" onclick="lik(1)">
                    <div class="rss">
                        <div>1</div>
                        <div>Very unlikely</div>
                    </div>
                </td>
                <td class="rs lik likelihood_2 clr_2" data-lik="2-Unlikely" onclick="lik(2)">
                    <div class="rss">
                        <div>2</div>
                        <div>Unlikely</div>
                    </div>
                </td>
                <td class="rs lik likelihood_3 clr_3" data-lik="3-May happen" onclick="lik(3)">
                    <div class="rss">
                        <div>3</div>
                        <div>May happen</div>
                    </div>
                </td>
                <td class="rs lik likelihood_4 clr_4" data-lik="4-Likely" onclick="lik(4)">
                    <div class="rss">
                        <div>4</div>
                        <div>Likely</div>
                    </div>
                </td>
                <td class="rs lik liks likelihood_5 clr_5 clr_5_active" data-lik="5-Almost certaine" onclick="lik(5)">
                    <div class="rss">
                        <div>5</div>
                        <div>Almost certain</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="5">Likelihood</td>
            </tr>


        </table>
    </div>

</div>
<div class="risk-panel hide" id="resrisk">
    <div class="tpos-lbl">Residual risk score (optional)</div>
    <div class="riskscoring">
        <table class="risk-tbl">
            <tr>
                <td colspan="5">Severity</td>
            </tr>
            <tr>
                <td class="rs sev severity_1 clr_1" data-sev="1 - Minor harm" onclick="sev(1)">
                    <div class="rss">
                        <div>1</div>
                        <div>Minior harm</div>
                    </div>
                </td>
                <td class="rs sev severity_2 clr_2" data-sev="2 - Moderate harm" onclick="sev(2)">
                    <div class="rss">
                        <div>2</div>
                        <div>Moderate harm</div>
                    </div>
                </td>
                <td class="rs sev severity_3 clr_3" data-sev="3 - Serious harm" onclick="sev(3)">
                    <div class="rss">
                        <div>3</div>
                        <div>Serious harm</div>
                    </div>
                </td>
                <td class="rs sev severity_4 clr_4" data-sev="4 - Marjor harm" onclick="sev(4)">
                    <div class="rss">
                        <div>4</div>
                        <div>Marjor harm</div>
                    </div>
                </td>
                <td class="rs sev sevs severity_5 clr_5 clr_5_active" data-sev="5 - Extreme Harm" onclick="sev(5)">
                    <div class="rss">
                        <div>5</div>
                        <div>Extreme Harm</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="5">
                    <table class="mini-risk-tbl">
                        <tr>
                            <td class="rsc rsc1 clr_1">1</td>
                            <td class="rsc rsc2 clr_1">2</td>
                            <td class="rsc rsc3 clr_1">3</td>
                            <td class="rsc rsc4 clr_1">4</td>
                            <td class="rsc rsc5 clr_1">5</td>
                            <td class="rsc rsc6 clr_4">6</td>
                            <td class="rsc rsc8 clr_4">8</td>
                            <td class="rsc rsc9 clr_4">9</td>
                            <td class="rsc rsc10 clr_5">10</td>
                            <td class="rsc rsc12 clr_5">12</td>
                            <td class="rsc rsc15 clr_5">15</td>
                            <td class="rsc rsc16 clr_5">16</td>
                            <td class="rsc rsc20 clr_5">20</td>
                            <td class="rsc rsc25 clr_5 clr_5_active">25</td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td class="rs lik likelihood_1 clr_1" data-lik="1 - Very unlikely" onclick="lik(1)">
                    <div class="rss">
                        <div>1</div>
                        <div>Very unlikely</div>
                    </div>
                </td>
                <td class="rs lik likelihood_2 clr_2" data-lik="2 - Unlikely" onclick="lik(2)">
                    <div class="rss">
                        <div>2</div>
                        <div>Unlikely</div>
                    </div>
                </td>
                <td class="rs lik likelihood_3 clr_3" data-lik="3 - May happen" onclick="lik(3)">
                    <div class="rss">
                        <div>3</div>
                        <div>May happen</div>
                    </div>
                </td>
                <td class="rs lik likelihood_4 clr_4" data-lik="4 - Likely" onclick="lik(4)">
                    <div class="rss">
                        <div>4</div>
                        <div>Likely</div>
                    </div>
                </td>
                <td class="rs lik liks likelihood_5 clr_5 clr_5_active" data-lik="5 - Almost certain" onclick="lik(5)">
                    <div class="rss">
                        <div>5</div>
                        <div>Almost certain</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="5">Likelihood</td>
            </tr>


        </table>
    </div>

</div>

<div class="tpos-info">Then select a sublot. Please note that you can only select one sublot at a time.</div>


<div class="select-panel" id="sites">
    <div class="tpos-lbl">Select a sublot</div>
    <div class="tpos-select" id="div_sel_sites"></div>
    <div>
        <input class="hide" type="text" name="" id="sctSite" value="0" placeholder="Select a sublot" />
    </div>
</div>

<div class="selectnext" id="next">
    <div class="tpos-info">Select any applicable structure (to record permanent works hazards) by clicking on it. Use the search box to quickly find the correct option(s).</div>

    <div class="tpos-info">Once you've selected a structure and wish to add another one, simply click the structure search box again.</div>

    <div class="tpos-info">Proceed in the same way with temporary works and RAMS.</div>
    <div class="select-panel" id="pwstructures">
        <div class="tpos-lbl">Select a structure</div>
        <div class="tpos-select" id="div_sel_structures"></div>
    </div>

    <div class="select-panel" id="tw">
        <div class="tpos-lbl">Select temporary works</div>
        <div class="tpos-select" id="div_sel_tw"></div>
    </div>
    <div class="select-panel" id="rams">
        <div class="tpos-lbl">Select a RAMS</div>
        <div class="tpos-select" id="div_sel_rams"></div>
    </div>

</div>

<div class="selectnext">
    <div class="tpos-info">If you wish to record the same hazard for structures, temporary works and/or RAMS for another sublot, you can select a new sublot be clicking the sublots search box. Selecting another sublot will empty all previously selected options and provide new
        sublot relevant options.</div>

    <div class="selection-panel" id="selection_panel">
        <div class="tpos-lbl">Selected sub lot</div>
        <div id="selectedsite" class="tpos-selection"></div>
        <div id="pwstructurespanel">
            <div id="selectedstructures" class="tpos-selection"></div>
        </div>
        <div id="twpanel">
            <div id="selectedtw" class="tpos-selection"></div>
        </div>
        <div id="ramspanel">
            <div id="selectedrams" class="tpos-selection"></div>
        </div>
    </div>
    <div class="tpos-info">Once you've selected at least one works designs and/or RAMS, the hazard can be saved. Should you have selected more than one works and/or RAMS, the hazard will be saved for all of them, i.e. the system will save the described hazard for each works
        design and/or RAMS specified. Each recorded hazard will contain the same metadata as specified by you.</div>

    <div class="button-row" style="display: none;">
        <!-- <div class="tpos-left-btn sv-cancel">Cancel</div> -->
        <div class="tpos-left-btn sv-hazard" onclick="savehazards();">Save</div>
    </div>
</div>



<div class="row row-hazard tpos-border-right-Amber hide" id="h_0">
    <div class="cell width-100">
        <div class="cell-cell lg" id="h_0_ID">Ref: tbc</div>
        <div class="cell-cell">
            <div class="cell-cell-img" id="h_0_cdmStage" title="Construction">
                <img style="width:16px;height:16px;" src="../../scripts/1.0/img/helmet.svg" alt="Construction">
            </div>
            <div class="cell-cell-img" id="h_0_cdmType" title="Health">
                <img style="width:16px;height:16px;" src="../../scripts/1.0/img/heartbeat.svg" alt="Health">
            </div>
        </div>
        <div class="cell-cell" id="h_0_cdmOwner" title="Owner">Mott MacDonald</div>
    </div>
    <div class="cell width-200">
        <div class="cell-cell" id="h_0_cdmSite" title="Sub Lot">SL1</div>
        <div class="cell-cell" id="h_0_cdmPWStructure" title="Structure">A425 Leamington Road Reinstatement</div>
        <div class="cell-cell" id="h_0_cdmPWElement" title="Element">Children's Play Equipment</div>
    </div>
    <div class="cell width-300 vwdefault">
        <div class="cell-cell" id="h_0_sm_cdmHazardDescription">Lorem ipsum dolor sit amet consectetur adipisicing elit.</div>
        <div class="cell-cell" id="h_0_sm_cdmRiskDescription">Lorem ipsum dolor sit amet, consectetur adipisicing elit.</div>
        <div class="cell-cell" id="h_0_sm_cdmMitigation">Lorem, ipsum dolor sit amet consectetur adipisicing elit.</div>
        <div class="cell-cell" id="h_0_sm_cdmMitigationSuggestion">Distinctio fugiat excepturi ducimus, pariatur.</div>
    </div>
    <div class="cell width-200 vwdefault">
        <div class="cell-cell bg-rs-2">
            <span>Impact </span>
            <span>2</span>
            <span> Moderate harm</span>
        </div>
        <div class="cell-cell bg-Amber">
            <span class="lg">Residual risk </span>
            <span class="lg">6</span>
            <span class="lg"> Medium</span>
        </div>
        <div class="cell-cell bg-rs-3">
            <span>Likelihood </span>
            <span>3</span>
            <span> Occasional</span>
        </div>
    </div>
    <div class="cell width-150 vwhover">
        <div class="cell-cell" id="h_0_cdmTags">Working at heights</div>
        <div class="cell-cell" id="h_0_cdmUniclass">Playground</div>
    </div>
    <div class="cell width-150 vwhover">
        <div class="cell-cell" id="h_0_cdmLinks">
            <div>
                <a href="http://example.com">A test link</a>
            </div>
            <div>
                <a href="http://example.com">Drawing</a>
            </div>
            <div>
                <a href="http://example.com">Map</a>
            </div>
        </div>

    </div>
    <div class="cell vwhover">
        <div class="fld">
            <div class="lbl">The hazard</div>
            <div class="cell-cell" id="h_0_cdmHazardDescription">Lorem ipsum dolor sit amet consectetur adipisicing elit. Illo inventore dicta aliquid voluptates, placeat reprehenderit vel quas perferendis maiores a iste veniam, iure perspiciatis unde quisquam sed! Repellat, dolorum ad.</div>

        </div>
        <div class="fld">
            <div class="lbl">The risk</div>
            <div class="cell-cell" id="h_0_cdmRiskDescription">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Distinctio fugiat excepturi ducimus, pariatur deleniti dolore autem totam quo quidem! Assumenda eius impedit obcaecati vel necessitatibus dolor ullam perferendis, quis voluptatem!</div>

        </div>
        <div class="fld">
            <div class="lbl">Our mitigation</div>
            <div class="cell-cell" id="h_0_cdmMitigation">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Saepe nulla minus alias quisquam sint officia rerum, provident sunt nostrum sapiente numquam enim quam unde atque tempore repudiandae dolore eum assumenda. Lorem ipsum dolor sit amet,
                consectetur adipisicing elit. Officiis eius laudantium nobis excepturi, tempore illum perferendis necessitatibus, natus esse delectus quia ea, reiciendis accusantium accusamus repellat quae temporibus deserunt fugiat.</div>

        </div>
        <div class="fld">
            <div class="lbl">Designer's mitigation suggestion for Construction</div>
            <div class="cell-cell" id="h_0_cdmMitigationSuggestion">Lorem ipsum dolor sit amet consectetur adipisicing elit. Ex labore nesciunt voluptas magnam ratione mollitia amet quae tempore fugit eveniet reiciendis similique, delectus unde aut quos doloremque maxime perspiciatis cum. eum assumenda.</div>
        </div>
        <div class="fld">
            <div class="lbl">Initial project control</div>
            <div class="cell-cell bg-Red" id="h_0_cdmInitialRag">RG10 - Lorem ipsum dolor sit amet consectetur adipisicing elit. Ex labore nesciunt voluptas magnam ratione mollitia amet quae tempore fugit eveniet reiciendis similique, delectus unde aut quos doloremque maxime perspiciatis cum. eum assumenda.</div>
        </div>
        <div class="fld">
            <div class="lbl">Residual project control</div>
            <div class="cell-cell bg-Green" id="h_0_cdmResidualRAG">GG48 - Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ex labore nesciunt voluptas magnam ratione mollitia amet quae tempore fugit eveniet reiciendis similique, delectus unde aut quos doloremque maxime perspiciatis cum. eum assumenda.</div>
        </div>

    </div>

    <div class="row-row" id="h_0_footer">
        <div class="cell width-100">
            <div class="cell-cell lbl">Created</div>
            <div class="cell-cell" id="h_0_Created">12/08/2018</div>
            <div class="cell-cell" id="h_0_Author">Daniel Rausch</div>

        </div>
        <div class="cell width-100">
            <div class="cell-cell lbl">Modified</div>
            <div class="cell-cell" id="h_0_Modified">18/08/2018</div>
            <div class="cell-cell" id="h_0_Editor">Daniel Rausch</div>

        </div>
        <div class="cell width-100">
            <div class="cell-cell lbl">Last review</div>
            <div class="cell-cell" id="h_0_cdmLastReviewDate">16/08/2018</div>
            <div class="cell-cell" id="h_0_cdmLastReviewer">Construction Manager</div>
        </div>
        <div class="cell width-100">
            <div class="cell-cell lbl">Current status</div>
            <div class="cell-cell" id="h_0_cdmCurrentStatus">Requires review</div>
        </div>
        <div class="cell width-200 fr vwhover">
            <div class="cell-cell bg-rs-2">
                <span>Impact </span>
                <span>2</span>
                <span> Moderate harm</span>
            </div>
            <div class="cell-cell bg-Amber">
                <span class="lg">Residual risk </span>
                <span class="lg">6</span>
                <span class="lg"> Medium</span>
            </div>
            <div class="cell-cell bg-rs-3">
                <span>Likelihood </span>
                <span>3</span>
                <span> Occasional</span>
            </div>
        </div>
        <div class="cell width-150 fr vwhover">
            <div class="cell-cell bg-rs-4">
                <span>Impact </span>
                <span>4</span>
                <span> Marjor harm</span>
            </div>
            <div class="cell-cell bg-Red">
                <span>Initial risk </span>
                <span class="lg">20</span>
                <span> High</span>
            </div>
            <div class="cell-cell bg-rs-5">
                <span>Likelihood </span>
                <span>5</span>
                <span> Definitive</span>
            </div>
        </div>
        <div class="vw vwshow vwdefault" id="h_0_vw">
            <img style="width:16px;height:16px;" src="../../scripts/1.0/img/dots.svg" alt="show me everything">
        </div>
        <div class="vw vwhide vwhover" id="h_0_vw">
            <img style="width:16px;height:16px;" src="../../scripts/1.0/img/dots.svg" alt="hide things">
        </div>

    </div>
</div>


<script>
    $(document).ready(function() {

    });

    function routeSelection(e, v, vn) {
        var sTerm = '';
        var t = '';
        var pc = 0,
            tc = 0,
            rc = 0;
        var nt = '';
        var lbl = '';
        if (e == 'cdmSites') {
            $('#div_sel_structures').html('');
            $('#div_sel_tw').html('');
            $('#div_sel_rams').html('');
            sTerm = '<div class="qresult" data-entity="site" data-name="' + vn + '" data-value="' + v + '"><span>' + vn +
                ' </span><span class="qrremove" data-field="sel_site">X</span></div>';
            $('#selectedsite').html(sTerm);
            $('#sel_cdmSites').val('');
            $('#selectedtw').html('');
            $('#selectedrams').html('');
            $('#selectedstructures').html('');

            //toastr.success('uuu');
            tposdata.get('cdmPWStructures', 'cdmSite/ID eq ' + v, '', 'sel_structures');
            jsondata.get('tw', vn, 'sel_tw');
            jsondata.get('rams', vn, 'sel_rams');
            $('.selectnext').show();
            page.scroll('#next');
        }
        if (e == 'cdmPWStructures') {
            t = $('#selectedstructures').html();


            var stgs = ['Construction', 'Commission', 'Operation', 'Maintenance', 'Demolition'];

            for (var i = 0; i < stgs.length; i++) {
                var stid = parseInt(i, 10) + 1;
                sTerm += '<div class="qresult" data-entity="permanent" data-stage="' + stid + '" data-name="' + vn +
                    '" data-value="' + v + '"><span>' + vn + ' - <span class="stge-option">' + stgs[i] + '</span>' +
                    ' </span><span class="qrremove" data-field="sel_structures">X</span></div>';
            }
            nt = t + sTerm;
            lbl = '<div class="tpos-lbl">Selected structure(s)</div>';
            if (nt) {
                $('#pwstructurespanel').html('');
                $('#pwstructurespanel').html(lbl + '<div id="selectedstructures" class="tpos-selection">' + nt +
                    '</div>');
                // $('#selectedstructures').prepend(lbl);
            }
            $('#sel_cdmPWStructures').val('');
        }
        if (e == 'tw') {
            t = $('#selectedtw').html();
            sTerm = '<div class="qresult" data-entity="temporary" data-stage="1" data-name="' + vn + '" data-value="' +
                v + '"><span>' + vn + ' </span><span class="qrremove" data-field="sel_tw">X</span></div>';
            nt = t + sTerm;
            lbl = '<div class="tpos-lbl">Selected temporary works</div>';
            if (nt) {
                $('#twpanel').html('');
                $('#twpanel').html(lbl + '<div id="selectedtw" class="tpos-selection">' + nt + '</div>');
            }
            $('#sel_tw').val('');
        }

        if (e == 'rams') {
            t = $('#selectedrams').html();
            sTerm = '<div class="qresult" data-entity="rams" data-stage="1" data-name="' + vn + '" data-value="' + v +
                '"><span class="qresultdisplay">' + vn +
                ' </span><span class="qrremove" data-field="sel_rams">X</span></div>';
            nt = t + sTerm;
            lbl = '<div class="tpos-lbl">Selected RAMS</div>';

            if (nt) {
                $('#ramspanel').html('');
                $('#ramspanel').html(lbl + '<div id="selectedrams" class="tpos-selection">' + nt + '</div>');
            }
            $('#sel_rams').val('');
        }

        var qrs = $('.qresult');
        for (var k = 0; k < qrs.length; k++) {
            var cn = qrs.eq(k);
            if (cn.data('entity') == 'permanent') {
                pc++;
            }
            if (cn.data('entity') == 'temporary') {
                tc++;
            }
            if (cn.data('entity') == 'rams') {
                rc++;
            }
        }
        if (pc + tc + rc > 0) {
            $('.button-row').show();


        } else {
            $('.button-row').hide();
        }


        $('.qrremove').click(function() {
            var crc = $(this).parent().parent();
            var crs = $(this).parent().siblings();
            $(this).parent().remove();
            if (!crs) {
                crc.html('');
            }
        });

        //$('.rss').addEventListener('click',testfunction);

    }

    function sev(n) {
        var lik = $('.liks').data('lik');
        var likscore = lik.substring(0, 1);
        var clr = '';

        var sev = $('.severity_' + n).data('sev');
        //$('.severity_'+n).removeClass('clr_'+n);
        $('.sev').removeClass('sevs');
        $('.sev').removeClass('clr_1_active');
        $('.sev').removeClass('clr_2_active');
        $('.sev').removeClass('clr_3_active');
        $('.sev').removeClass('clr_4_active');
        $('.sev').removeClass('clr_5_active');
        $('.severity_' + n).addClass('clr_' + n + '_active');
        $('.severity_' + n).addClass('sevs');

        var riskscore = parseInt(n, 10) * parseInt(likscore, 10);

        $('.rsc').removeClass('clr_1_active');
        $('.rsc').removeClass('clr_2_active');
        $('.rsc').removeClass('clr_3_active');
        $('.rsc').removeClass('clr_4_active');
        $('.rsc').removeClass('clr_5_active');
        if (riskscore < 5) {
            clr = 'clr_1_active';
        }
        if (riskscore >= 5 && riskscore < 10) {
            clr = 'clr_4_active';
        }
        if (riskscore >= 10) {
            clr = 'clr_5_active';
        }

        $('.rsc' + riskscore).addClass(clr);
        var rsk = $('.rsc' + riskscore).data('rsk');

        var frsk = rsk + '^' + sev + '^' + lik;
        $('#cdmInitialRisk').html(frsk);
    }

    function lik(n) {
        var sev = $('.sevs').data('sev');
        var sevscore = sev.substring(0, 1);
        var clr = '';

        var lik = $('.likelihood_' + n).data('lik');
        //$('.severity_'+n).removeClass('clr_'+n);
        $('.lik').removeClass('liks');
        $('.lik').removeClass('clr_1_active');
        $('.lik').removeClass('clr_2_active');
        $('.lik').removeClass('clr_3_active');
        $('.lik').removeClass('clr_4_active');
        $('.lik').removeClass('clr_5_active');
        $('.likelihood_' + n).addClass('clr_' + n + '_active');
        $('.likelihood_' + n).addClass('liks');

        var riskscore = parseInt(n, 10) * parseInt(sevscore, 10);

        $('.rsc').removeClass('clr_1_active');
        $('.rsc').removeClass('clr_2_active');
        $('.rsc').removeClass('clr_3_active');
        $('.rsc').removeClass('clr_4_active');
        $('.rsc').removeClass('clr_5_active');
        if (riskscore < 5) {
            clr = 'clr_1_active';
        }
        if (riskscore >= 5 && riskscore < 10) {
            clr = 'clr_4_active';
        }
        if (riskscore >= 10) {
            clr = 'clr_5_active';
        }

        $('.rsc' + riskscore).addClass(clr);

        var rsk = $('.rsc' + riskscore).data('rsk');

        var frsk = rsk + '^' + sev + '^' + lik;

        $('#cdmInitialRisk').html(frsk);


    }

    function savehazards() {

        var newhazards = [];
        var site = 0;
        var pw = [];
        var tw = [];
        var rams = [];
        var title1 = new Date();
        var title10 = title1.getTime() + '^' + title1.getDate() + '^' + title1.getMonth() + 1 + '^' + title1.getFullYear();
        //var title2=uid();
        var title = title10.toString() + '^' + uid();
        var hz = $('#cdmHazardDescription').val();
        var rs = $('#cdmRiskDescription').val();
        var ms = $('#cdmMitigationDescription').val();
        if (!hz) {
            toastr.error('Please describe the hazard');
        }
        if (!rs) {
            rs = 'Awaiting risk assessment';
        }
        if (!ms) {
            ms = 'Awaiting mitigation';
        }

        var qr = $('.qresult');
        for (var j = 0; j < qr.length; j++) {
            var o = qr.eq(j);

            var type = o.data('entity');
            var name = o.data('name');
            var value = o.data('value');
            toastr.success(type);
            if (type == 'site') {
                site = value;
            }
            if (type == 'permanent') {
                var stage = o.data('stage');
                pw.push([name, value, stage]);
            }
            if (type == 'temporary') {
                tw.push([name, value]);
            }
            if (type == 'rams') {
                rams.push([name, value]);
            }
        }
        var risks = $('#cdmInitialRisk').html();
        var trisks = risks.split('-');
        var riskscoreval = trisks[0];
        var rscv = parseInt(riskscoreval, 10);

        if (pw.length > 0) {

            for (var ps = 0; ps < pw.length; ps++) {
                var tdata = [];
                // toastr.success(site);
                tdata.push('Title|' + title);
                tdata.push('cdmHazardDescription|' + hz);
                tdata.push('cdmRiskDescription|' + rs);
                tdata.push('cdmMitigationDescription|' + ms);
                tdata.push('cdmSite|' + site);
                tdata.push('cdmInitialRisk|' + risks);
                tdata.push('cdmResidualRisk|' + risks);
                tdata.push('cdmHazardType|1');
                tdata.push('cdmInitialRiskScore|' + rscv);
                tdata.push('cdmResidualRiskScore|' + rscv);

                // tdata.push('cdmIniRisk|'+$('#inirisk').prop('outerHTML'));
                // tdata.push('cdmResRisk|'+$('#inirisk').prop('outerHTML'));
                tdata.push('cdmPWStructure|' + pw[ps][1]);
                tdata.push('cdmStageExtra|' + pw[ps][2]);
                newhazards.push(tdata);
            }

        }
        if (tw.length > 0) {
            for (var ts = 0; ts < tw.length; ts++) {
                var tdata = [];
                // toastr.success(site);
                tdata.push('Title|' + title);
                tdata.push('cdmHazardDescription|' + hz);
                tdata.push('cdmRiskDescription|' + rs);
                tdata.push('cdmMitigationDescription|' + ms);
                tdata.push('cdmSite|' + site);
                tdata.push('cdmInitialRisk|' + risks);
                tdata.push('cdmResidualRisk|' + risks);
                tdata.push('cdmHazardType|1');
                tdata.push('cdmInitialRiskScore|' + rscv);
                tdata.push('cdmResidualRiskScore|' + rscv);

                // tdata.push('cdmIniRisk|'+$('#inirisk').prop('outerHTML'));
                // tdata.push('cdmResRisk|'+$('#inirisk').prop('outerHTML'));

                tdata.push('cdmTW|' + tw[ts][1]);
                tdata.push('cdmEntityTitle|' + tw[ts][0]);
                tdata.push('cdmStageExtra|1');
                newhazards.push(tdata);

            }


        }
        if (rams.length > 0) {
            for (var ras = 0; ras < rams.length; ras++) {
                var tdata = [];
                // toastr.success(site);
                tdata.push('Title|' + title);
                tdata.push('cdmHazardDescription|' + hz);
                tdata.push('cdmRiskDescription|' + rs);
                tdata.push('cdmMitigationDescription|' + ms);
                tdata.push('cdmSite|' + site);
                tdata.push('cdmInitialRisk|' + risks);
                tdata.push('cdmResidualRisk|' + risks);
                tdata.push('cdmHazardType|1');
                tdata.push('cdmInitialRiskScore|' + rscv);
                tdata.push('cdmResidualRiskScore|' + rscv);
                // tdata.push('cdmIniRisk|'+$('#inirisk').prop('outerHTML'));
                // tdata.push('cdmResRisk|'+$('#inirisk').prop('outerHTML'));

                tdata.push('cdmRAMS|' + rams[ras][1]);
                tdata.push('cdmEntityTitle|' + rams[ras][0]);
                tdata.push('cdmStageExtra|1');
                newhazards.push(tdata);

            }


        }
        for (var dd = 0; dd < newhazards.length; dd++) {
            tposdata.set('cdmHazards', newhazards[dd], 'qmsg');
        }
        $('#div_sel_structures').html('');
        $('#div_sel_tw').html('');
        $('#div_sel_rams').html('');
        $('#sel_cdmSites').val('');
        $('#selectedtw').html('');
        $('#selectedrams').html('');
        $('#selectedstructures').html('');
        $('.button-row').hide();


    }
</script><html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"><head>
<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:_dlc_DocId msdt:dt="string">5555552-1953831272-126</mso:_dlc_DocId>
<mso:_dlc_DocIdItemGuid msdt:dt="string">d674307d-e6d3-441e-b3c9-45e7e558aa55</mso:_dlc_DocIdItemGuid>
<mso:_dlc_DocIdUrl msdt:dt="string">https://mottmac.sharepoint.com/teams/pj-a814/ps-master/_layouts/15/DocIdRedir.aspx?ID=5555552-1953831272-126, 5555552-1953831272-126</mso:_dlc_DocIdUrl>
<mso:MediaServiceImageTags msdt:dt="string"></mso:MediaServiceImageTags>
<mso:lcf76f155ced4ddcb4097134ff3c332f msdt:dt="string"></mso:lcf76f155ced4ddcb4097134ff3c332f>
<mso:TaxCatchAll msdt:dt="string"></mso:TaxCatchAll>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>